<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RIDER TRACKER PRO V4.7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg:#0f0f0f; --card:#1a1a1a; --primary:#00CCBC; --accent:#ff4d4d; --text:#e0e0e0; --dim:#888; --danger:#d32f2f; --input-bg:#252525; }
        * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; margin:0; padding:0; }
        
        body { font-family:sans-serif; background:var(--bg); color:var(--text); height: 100vh; width: 100vw; display: flex; flex-direction: column; padding: 8px; overflow: hidden; position: fixed; }
        
        /* DASHBOARD (CONGELATA) */
        .app-title-container { text-align: center; padding: 15px 0; border-bottom: 2px solid #333; margin-bottom: 10px; }
        .app-title { font-size: 26px; font-weight: 900; color: var(--primary); text-transform: uppercase; }
        .grid { display:grid; grid-template-columns:repeat(3, 1fr); gap:6px; margin-bottom: 5px; }
        .card { background:var(--card); border-radius:12px; border:1px solid #333; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 65px; }
        .label { font-size:7px; color:var(--dim); font-weight:bold; text-transform:uppercase; }
        .val { font-size:13px; font-weight:bold; color: #fff; }
        .card input { width:80%; background:transparent; border:none; border-bottom:1px solid var(--primary); color:#fff; text-align:center; font-size:14px; outline:none; }

        .sticky-footer { background:#161616; padding:12px; border-radius:20px; border:2px solid #333; margin-top: auto; margin-bottom: 70px; display: flex; flex-direction: column; gap: 10px; }
        .btn-group-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .foot-btn { background:#222; color:#fff; padding:12px 5px; border-radius:12px; font-size:10px; display:flex; flex-direction:column; align-items:center; border:1px solid #444; }
        .btn-full-action { width: 100%; padding:16px; border-radius:12px; font-weight:900; border:none; text-transform: uppercase; font-size: 12px; cursor:pointer; }

        /* MODALE CORRETTA - NON SPARISCE IN ALTO */
        .modal { 
            display:none; position:fixed; inset:0; z-index:9999; 
            background:rgba(0,0,0,0.92); 
            display: none; align-items: center; justify-content:center;
            padding: 10px; /* Spazio dai bordi dello schermo */
        }
        .modal-content { 
            background:var(--card); padding:20px; border-radius:24px; 
            width:100%; max-width:340px; border:2px solid var(--primary);
            max-height: 95vh; overflow-y: auto; /* Permette lo scroll se serve */
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .modal h3 { margin-bottom: 20px; text-align: center; color: var(--primary); font-size: 20px; text-transform: uppercase; }
        .modal input { 
            width:100%; padding:14px; background:var(--input-bg); 
            border:1px solid #444; color:#fff; border-radius:12px; 
            margin-bottom:12px; font-size: 16px; outline: none;
        }
        .modal input:focus { border-color: var(--primary); background: #2a2a2a; }

        /* REPORT (CONGELATO) */
        #winReport { display:none; position:fixed; inset:0; z-index:10000; background:#fff; color:#000; flex-direction:column; padding:15px; overflow-y:auto; }
    </style>
</head>
<body>

    <div class="app-title-container"><h1 class="app-title">RIDER TRACKER <span>V4.7</span></h1></div>

    <div class="grid">
        <div class="card"><span class="label">LORDO</span><span class="val">€<span id="lordo">0.00</span></span></div>
        <div class="card"><span class="label">NETTO</span><span class="val" id="netto" style="color:var(--accent)">€0.00</span></div>
        <div class="card"><span class="label">ORE</span><span class="val" id="ore">0.0</span></div>
        <div class="card"><span class="label">LITRI</span><span class="val" id="cons">0.0</span></div>
        <div class="card"><span class="label">KM/L</span><span class="val" id="kml">0.0</span></div>
        <div class="card"><span class="label">SPESA B.</span><span class="val" id="spesaB">€0.00</span></div>
        <div class="card"><span class="label">TARGET</span><input type="number" id="targetIn" oninput="aggiornaDati()"></div>
        <div class="card"><span class="label">TAX %</span><input type="number" id="taxIn" oninput="aggiornaDati()"></div>
        <div class="card"><span class="label">MANCANTE</span><span class="val" id="mancante" style="color:var(--primary)">€0.00</span></div>
    </div>

    <div class="sticky-footer">
        <div class="btn-group-3">
            <div class="foot-btn" onclick="toggleWin('winTurno', true)"><i class="fas fa-plus-circle" style="font-size:20px; color:var(--primary); margin-bottom:4px;"></i>TURNO</div>
            <div class="foot-btn" onclick="toggleWin('winBenza', true)"><i class="fas fa-gas-pump" style="font-size:20px; color:var(--primary); margin-bottom:4px;"></i>BENZINA</div>
            <div class="foot-btn" onclick="toggleWin('winStorico', true)"><i class="fas fa-history" style="font-size:20px; color:var(--primary); margin-bottom:4px;"></i>STORICO</div>
        </div>
        <button class="btn-full-action" style="background:var(--primary); color:#000;" onclick="apriReport()">GENERA REPORT PDF</button>
    </div>

    <div id="winTurno" class="modal">
        <div class="modal-content">
            <h3>Nuovo Turno</h3>
            <input type="number" id="tL" placeholder="Lordo (€)">
            <input type="number" id="tO" placeholder="Ore">
            <input type="number" id="tK" placeholder="KM">
            <input type="number" id="tC" placeholder="L/100km">
            <button class="btn-full-action" style="background:var(--primary); color:#000; margin-bottom:10px;" onclick="salvaAzione('T')">SALVA DATI</button>
            <button class="btn-full-action" style="background:#333; color:#fff;" onclick="toggleWin('winTurno', false)">ANNULLA</button>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('rider_db_final')) || { turni: [], benza: [], tax: 20, target: 0 };

        function toggleWin(id, show) { 
            const el = document.getElementById(id);
            el.style.display = show ? 'flex' : 'none'; 
            if(show) {
                // Piccola correzione per scrollare in alto se la tastiera era già attiva
                window.scrollTo(0,0);
            }
        }

        function salvaAzione(tipo) {
            const d = new Date().toLocaleDateString('it-IT');
            if(tipo==='T') {
                db.turni.push({ 
                    id:Date.now(), data:d, 
                    lordo:parseFloat(document.getElementById('tL').value)||0, 
                    ore:parseFloat(document.getElementById('tO').value)||0, 
                    km:parseFloat(document.getElementById('tK').value)||0, 
                    cons:parseFloat(document.getElementById('tC').value)||0 
                });
            }
            localStorage.setItem('rider_db_final', JSON.stringify(db));
            aggiornaDati(); 
            toggleWin('winTurno', false);
            // Pulisce campi
            document.getElementById('tL').value = ""; document.getElementById('tO').value = "";
            document.getElementById('tK').value = ""; document.getElementById('tC').value = "";
        }

        function aggiornaDati() {
            let lordo = db.turni.reduce((a,b)=>a+b.lordo, 0);
            document.getElementById('lordo').innerText = lordo.toFixed(2);
        }

        window.onload = aggiornaDati;
    </script>
</body>
</html>
