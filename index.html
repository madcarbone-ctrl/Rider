<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Rider Tracker Pro v94 V18</title>
    <style>
        :root { --main: #00CCBC; --fuel: #ffa500; --bg: #0a0a0a; --card: #161616; --danger: #ff4444; }
        body { background: var(--bg); color: #eee; font-family: sans-serif; margin: 0; padding: 5px; font-size: 14px; }
        * { box-sizing: border-box; }
        
        .card { background: var(--card); padding: 10px; border-radius: 12px; border: 1px solid #222; margin-bottom: 8px; }
        .main-title { color: var(--main); text-align: center; font-weight: bold; margin-bottom: 10px; }
        
        /* Griglia Dati */
        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .data-box { background: #1f1f1f; padding: 5px; border-radius: 8px; border: 1px solid #333; text-align: center; cursor: pointer; }
        .stat-label { font-size: 9px; color: #888; text-transform: uppercase; display: block; }
        .stat-val { font-size: 13px; font-weight: bold; }

        /* Input e Date */
        .input-row { display: flex; gap: 5px; margin-top: 5px; }
        .input-group { flex: 1; }
        select, input { width: 100%; background: #222; color: #fff; border: 1px solid #444; border-radius: 5px; height: 30px; text-align: center; font-size: 14px; }
        label { font-size: 10px; color: #aaa; font-weight: bold; }

        /* Bottoni */
        button { width: 100%; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; height: 38px; margin-top: 5px; text-transform: uppercase; }
        .btn-add { background: var(--main); color: #000; }
        .btn-fuel { background: var(--fuel); color: #000; }
        .btn-reset { background: #2a0a0a; color: var(--danger); border: 1px solid #400; height: 30px; font-size: 10px; margin-top: 15px; }

        /* Pop-up */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 999; }
        .modal-content { background: #1a1a1a; padding: 20px; border-radius: 15px; border: 1px solid #333; width: 85%; text-align: center; }

        #toast { visibility: hidden; background: var(--main); color: #000; padding: 10px; position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); border-radius: 20px; z-index: 1000; }
        #toast.show { visibility: visible; }
        
        #wrapperStorico { display: none; margin-top: 10px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body onload="inizia()">

    <div class="card">
        <div class="main-title">üöó RIDER TRACKER PRO</div>
        <div class="summary-grid">
            <div class="data-box" onclick="apriPop('Lordo','Totale guadagni lordi')"><span class="stat-label">Lordo</span><span class="stat-val">‚Ç¨<span id="vLordo">0</span></span></div>
            <div class="data-box" onclick="apriPop('Netto','Guadagno pulito stimato')"><span class="stat-label">Netto</span><span class="stat-val" style="color:var(--main)">‚Ç¨<span id="vNetto">0</span></span></div>
            <div class="data-box" onclick="apriPop('Benzina','Costo totale carburante')"><span class="stat-label">Benzina</span><span class="stat-val" style="color:var(--danger)">‚Ç¨<span id="vBenza">0</span></span></div>
        </div>
        <div class="input-row" style="margin-top:10px;">
            <div class="input-group">
                <label>OBIETTIVO NETTO (‚Ç¨)</label>
                <input type="number" id="targetIn" oninput="salvaT()" placeholder="Esempio: 1000">
            </div>
        </div>
    </div>

    <div class="card" style="border-left: 4px solid var(--fuel)">
        <div class="main-title" style="color:var(--fuel); font-size:11px;">‚õΩ RIFORNIMENTO</div>
        <div class="input-row">
            <select id="fG"></select><select id="fM"></select><select id="fA"></select>
        </div>
        <div class="input-row">
            <div class="input-group"><label>‚Ç¨ SPESI</label><input type="number" id="fEuro" step="0.01"></div>
            <div class="input-group"><label>‚Ç¨/LITRO</label><input type="number" id="fPrezzo" step="0.001"></div>
        </div>
        <button class="btn-fuel" onclick="addB()">SALVA BENZINA</button>
    </div>

    <div class="card" style="border-left: 4px solid var(--main)">
        <div class="main-title" style="color:var(--main); font-size:11px;">‚ûï AGGIUNGI TURNO</div>
        <div class="input-row">
            <select id="sG"></select><select id="sM"></select><select id="sA"></select>
        </div>
        <div class="input-row">
            <div class="input-group"><label>LORDO ‚Ç¨</label><input type="number" id="tLordo"></div>
            <div class="input-group"><label>KM</label><input type="number" id="tKm"></div>
        </div>
        <button class="btn-add" onclick="addS()">SALVA TURNO</button>
    </div>

    <button style="background:#222; color:#aaa;" onclick="toggleH()">üìú MOSTRA STORICO</button>
    <div id="wrapperStorico"></div>

    <button class="btn-reset" onclick="resetTutto()">‚ö†Ô∏è AZZERA TUTTO (ANCHE TARGET)</button>

    <div id="pop" class="modal" onclick="chiudiPop()">
        <div class="modal-content">
            <h2 id="popT" style="color:var(--main); margin-top:0;"></h2>
            <p id="popD"></p>
            <button class="btn-add" onclick="chiudiPop()">OK</button>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        let dati = JSON.parse(localStorage.getItem('rider_db_v94')) || { s: [], r: [], t: 0 };

        function inizia() {
            riempiDate();
            document.getElementById('targetIn').value = dati.t || "";
            calcola();
        }

        function riempiDate() {
            const d = new Date();
            const gg = d.getDate(), mm = d.getMonth()+1, aa = d.getFullYear();
            const selez = ['fG','sG','fM','sM','fA','sA'];
            selez.forEach(id => document.getElementById(id).innerHTML = "");

            for(let i=1; i<=31; i++) {
                const opt = `<option value="${i}" ${i==gg?'selected':''}>${i}</option>`;
                document.getElementById('fG').innerHTML += opt;
                document.getElementById('sG').innerHTML += opt;
            }
            for(let i=1; i<=12; i++) {
                const opt = `<option value="${i}" ${i==mm?'selected':''}>${i}</option>`;
                document.getElementById('fM').innerHTML += opt;
                document.getElementById('sM').innerHTML += opt;
            }
            for(let i=2024; i<=2026; i++) {
                const opt = `<option value="${i}" ${i==aa?'selected':''}>${i}</option>`;
                document.getElementById('fA').innerHTML += opt;
                document.getElementById('sA').innerHTML += opt;
            }
        }

        function calcola() {
            let lordo = 0, benza = 0;
            dati.s.forEach(x => lordo += parseFloat(x.l || 0));
            dati.r.forEach(x => benza += parseFloat(x.e || 0));
            
            let netto = (lordo * 0.8) - benza;

            document.getElementById('vLordo').innerText = lordo.toFixed(2);
            document.getElementById('vBenza').innerText = benza.toFixed(2);
            document.getElementById('vNetto').innerText = netto.toFixed(2);
        }

        function addB() {
            const e = document.getElementById('fEuro').value;
            const p = document.getElementById('fPrezzo').value;
            if(!e || !p) return alert("Inserisci i dati benzina");
            dati.r.push({ e: e, p: p });
            salva();
            document.getElementById('fEuro').value = "";
            showT("Benzina salvata!");
        }

        function addS() {
            const l = document.getElementById('tLordo').value;
            if(!l) return alert("Inserisci il lordo");
            dati.s.push({ l: l });
            salva();
            document.getElementById('tLordo').value = "";
            showT("Turno salvato!");
        }

        function salvaT() { dati.t = document.getElementById('targetIn').value; salva(); }
        function salva() { localStorage.setItem('rider_db_v94', JSON.stringify(dati)); calcola(); }

        function apriPop(t, d) {
            document.getElementById('popT').innerText = t;
            document.getElementById('popD').innerText = d;
            document.getElementById('pop').style.display = 'flex';
        }
        function chiudiPop() { document.getElementById('pop').style.display = 'none'; }

        function showT(m) {
            const x = document.getElementById('toast');
            x.innerText = m; x.className = "show";
            setTimeout(() => { x.className = ""; }, 2000);
        }

        function resetTutto() {
            if(confirm("Sei sicuro? Cancellerai TUTTO e il Target torner√† vuoto.")) {
                dati = { s: [], r: [], t: 0 };
                document.getElementById('targetIn').value = "";
                salva();
                showT("Dati resettati!");
            }
        }

        function toggleH() {
            const w = document.getElementById('wrapperStorico');
            w.style.display = w.style.display === 'block' ? 'none' : 'block';
            w.innerHTML = "";
            [...dati.s, ...dati.r].forEach(i => {
                w.innerHTML += `<div style="background:#222; padding:5px; margin-bottom:2px; font-size:11px; border-radius:5px;">Voce: ‚Ç¨${i.l || i.e}</div>`;
            });
        }
    </script>
</body>
</html>
