<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rider Tracker V3.9 - Storico Integrato</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- STILI INVARIATI (DASHBOARD) --- */
        :root { --bg: #000; --card: #111; --primary: #00ff88; --accent: #ff3344; --dim: #888; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: #fff; padding: 15px; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #222; }
        .stat-card i { color: var(--primary); font-size: 1.2rem; margin-bottom: 8px; }
        .val { font-size: 1.4rem; font-weight: bold; display: block; }
        .lab { font-size: 0.7rem; color: var(--dim); text-transform: uppercase; }

        .btn-main { width: 80px; height: 80px; background: var(--accent); border-radius: 50%; border: none; 
                    box-shadow: 0 0 20px rgba(255,51,68,0.4); margin: 20px auto; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .btn-main i { color: #fff; font-size: 2rem; }

        /* --- STILI STORICO (COPIATI DAL TUO FILE) --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: #111; padding: 20px; border-radius: 20px; width: 95%; max-width: 500px; border: 1px solid #333; }
        
        .storico-container { max-height: 60vh; overflow-y: auto; background: #0a0a0a; border-radius: 10px; margin: 15px 0; border: 1px solid #222; }
        .storico-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .storico-table th { position: sticky; top: 0; background: #222; padding: 12px 8px; text-align: left; color: var(--dim); }
        .storico-table td { padding: 12px 8px; border-bottom: 1px solid #1a1a1a; }
        
        .riga-turno { border-left: 4px solid var(--primary); }
        .riga-benza { border-left: 4px solid var(--accent); }
        .badge-tipo { padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: bold; color: #000; }
        
        .btn-full { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* Navigazione */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #222; }
        .nav-item { color: var(--dim); text-align: center; font-size: 0.7rem; text-decoration: none; cursor: pointer; }
        .nav-item i { display: block; font-size: 1.2rem; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div class="dashboard">
        <div class="stat-card"><i class="fas fa-euro-sign"></i><span class="val" id="dashLordo">0.00</span><span class="lab">Lordo Tot</span></div>
        <div class="stat-card"><i class="fas fa-gas-pump" style="color:var(--accent)"></i><span class="val" id="dashNetto">0.00</span><span class="lab">Netto Tot</span></div>
        <div class="stat-card"><i class="fas fa-clock"></i><span class="val" id="dashOre">0</span><span class="lab">Ore Totali</span></div>
        <div class="stat-card"><i class="fas fa-chart-line"></i><span class="val" id="dashMedia">0.00</span><span class="lab">Media €/h</span></div>
    </div>

    <button class="btn-main" onclick="toggleWin('winTurno', true)"><i class="fas fa-plus"></i></button>

    <div id="winStorico" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:10px;"><i class="fas fa-history"></i> STORICO</h3>
            <div class="storico-container">
                <table class="storico-table">
                    <thead>
                        <tr>
                            <th>DATA</th>
                            <th>TIPO</th>
                            <th>LORDO</th>
                            <th>INFO</th>
                        </tr>
                    </thead>
                    <tbody id="corpoStorico">
                        </tbody>
                </table>
            </div>
            <button class="btn-full" style="background:#333; color:#fff;" onclick="toggleWin('winStorico', false)">CHIUDI</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item" onclick="location.reload()"><i class="fas fa-home"></i>HOME</div>
        <div class="nav-item" onclick="toggleWin('winStorico', true)"><i class="fas fa-list"></i>STORICO</div>
        <div class="nav-item"><i class="fas fa-cog"></i>SETTING</div>
    </nav>

    <script>
        // Database locale
        let db = JSON.parse(localStorage.getItem('riderDB')) || { turni: [], benza: [] };

        function toggleWin(id, show) {
            document.getElementById(id).style.display = show ? 'flex' : 'none';
            if(id === 'winStorico' && show) aggiornaStorico();
        }

        function aggiornaStorico() {
            const corpo = document.getElementById('corpoStorico');
            corpo.innerHTML = "";

            // Unione dati come nel file originale
            let dati = [
                ...db.turni.map(t => ({...t, tipo: 'TURNO', classe: 'riga-turno', color: '#00ff88'})),
                ...db.benza.map(b => ({...b, tipo: 'BENZINA', classe: 'riga-benza', color: '#ff3344'}))
            ].sort((a,b) => b.id - a.id);

            if(dati.length === 0) {
                corpo.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px;'>Vuoto</td></tr>";
                return;
            }

            dati.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = item.classe;
                const info = item.tipo === 'TURNO' ? `${item.ore}h` : `${item.euro}€`;
                const val = item.tipo === 'TURNO' ? `€${item.lordo}` : `GAS`;

                tr.innerHTML = `
                    <td>${item.data}</td>
                    <td><span class="badge-tipo" style="background:${item.color}">${item.tipo}</span></td>
                    <td><b>${val}</b></td>
                    <td style="color:var(--dim)">${info}</td>
                `;
                corpo.appendChild(tr);
            });
        }

        // Funzione per aggiornare la dashboard (Invariata)
        function refreshDash() {
            let lordo = db.turni.reduce((s, t) => s + parseFloat(t.lordo), 0);
            let ore = db.turni.reduce((s, t) => s + parseFloat(t.ore), 0);
            document.getElementById('dashLordo').innerText = lordo.toFixed(2);
            document.getElementById('dashOre').innerText = ore;
            document.getElementById('dashMedia').innerText = ore > 0 ? (lordo/ore).toFixed(2) : "0.00";
        }

        window.onload = refreshDash;
    </script>
</body>
</html>
