<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GOLDEN CORE V1.0 - RIDER TRACKER PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg:#0f0f0f; --card:#1a1a1a; --primary:#00CCBC; --accent:#ff4d4d; --text:#e0e0e0; --dim:#888; --input-bg:#252525; }
        * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        body { font-family:sans-serif; background:var(--bg); color:var(--text); margin:0; padding:10px; text-align:center; }
        
        .app-title { margin:10px 0; font-size:18px; font-weight:900; color:var(--primary); text-transform:uppercase; }
        
        .grid { display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; margin-bottom:15px; }
        .card { background:var(--card); height:70px; display:flex; flex-direction:column; justify-content:center; align-items:center; border-radius:12px; border:1px solid #333; }
        .label { font-size:8px; color:var(--dim); text-transform:uppercase; margin-bottom:4px; }
        .val { font-size:14px; font-weight:bold; }
        .card.main .val { color:var(--primary); }
        .card input { width:80%; background:transparent; border:none; border-bottom:1px solid #444; color:#fff; text-align:center; font-size:14px; outline:none; }
        
        .progress-container { background:var(--card); padding:15px; border-radius:15px; margin-bottom:80px; border:1px solid #333; }
        .progress-bar { background:#222; height:20px; border-radius:10px; overflow:hidden; border:1px solid #444; margin-bottom:10px; }
        #bar { background:var(--primary); height:100%; width:0%; transition:0.3s; }
        #liveClock { font-family:monospace; color:var(--dim); font-size:12px; }
        
        .modal, #reportView { display:none; position:fixed; inset:0; z-index:1000; background:rgba(0,0,0,0.95); padding:20px; overflow-y:auto; }
        #reportView { background:#fff; color:#000; text-align:left; font-family: 'Courier New', Courier, monospace; }
        
        .modal-content { background:var(--card); padding:20px; border-radius:20px; width:100%; max-width:400px; margin:auto; border:1px solid var(--primary); }
        .modal h3 { margin-top:0; color:var(--primary); }
        .modal input { width:100%; padding:12px; background:var(--input-bg); border:1px solid #444; color:#fff; border-radius:10px; margin-bottom:10px; font-size:16px; }
        
        .btn-modal { width:100%; padding:15px; border-radius:10px; border:none; font-weight:bold; margin-top:10px; }
        .btn-save { background:var(--primary); color:#000; }
        .btn-close { background:#333; color:#fff; }
        
        .sticky-footer { position:fixed; bottom:0; left:0; right:0; background:#161616; padding:15px; display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; border-top:1px solid #333; }
        .foot-btn { background:#222; border:1px solid #444; color:#fff; padding:10px; border-radius:10px; display:flex; flex-direction:column; align-items:center; font-size:10px; }
        .foot-btn i { font-size:18px; color:var(--primary); margin-bottom:5px; }
        .btn-full { grid-column:span 3; background:var(--primary); color:#000; padding:12px; border-radius:10px; font-weight:bold; border:none; }

        .report-header { border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:20px; }
        .report-table { width:100%; border-collapse:collapse; font-size:12px; }
        .report-table th, .report-table td { border:1px solid #000; padding:8px; text-align:center; }
        .report-summary { margin-top:20px; border-top:2px solid #000; padding-top:10px; }
        
        @media print { .no-print { display:none; } #reportView { display:block; position:static; } }
    </style>
</head>
<body>
    <div id="mainUI" class="no-print">
        <div class="app-title">GOLDEN CORE V1.0</div>
        
        <div class="grid">
            <div class="card main"><span class="label">LORDO TOTALE</span><span class="val">€<span id="lordo">0.00</span></span></div>
            <div class="card main"><span class="label">NETTO STIMATO</span><span class="val" id="netto">€0.00</span></div>
            <div class="card"><span class="label">ORE TOTALI</span><span class="val" id="ore">0.0</span></div>
            <div class="card"><span class="label">LITRI CONSUM.</span><span class="val" id="cons">0.0L</span></div>
            <div class="card"><span class="label">KM TOTALI</span><span class="val" id="kmTot">0</span></div>
            <div class="card"><span class="label">TARGET (€)</span><input type="number" id="targetIn" oninput="salvaTarget()"></div>
            <div class="card"><span class="label">TASSE %</span><input type="number" id="taxIn" oninput="salvaTax()" value="20"></div>
            <div class="card"><span class="label">MANCANTE</span><span class="val" id="mancante">€0.00</span></div>
        </div>

        <div class="progress-container">
            <div class="progress-bar"><div id="bar"></div></div>
            <div id="liveClock">--/--/-- 00:00:00</div>
        </div>
    </div>
<script>
    let db = JSON.parse(localStorage.getItem('rider_db_v1')) || { turni: [], target: 0, tax: 20 };

    function startClock() {
        setInterval(() => {
            document.getElementById('liveClock').innerText = new Date().toLocaleString();
        }, 1000);
    }

    function salvaDB() {
        localStorage.setItem('rider_db_v1', JSON.stringify(db));
        calcola();
    }

    function calcola() {
        let lordo = db.turni.reduce((a, b) => a + b.lordo, 0);
        let ore = db.turni.reduce((a, b) => a + b.ore, 0);
        let km = db.turni.reduce((a, b) => a + b.km, 0);
        let litri = db.turni.reduce((a, b) => a + (b.km * (b.cons / 100)), 0);
        
        // Stima costo benzina fissa 1.80€ per matrice
        let costoBenza = litri * 1.80;
        let tasse = lordo * (db.tax / 100);
        let netto = lordo - tasse - costoBenza;

        document.getElementById('lordo').innerText = lordo.toFixed(2);
        document.getElementById('netto').innerText = '€' + netto.toFixed(2);
        document.getElementById('ore').innerText = ore.toFixed(1);
        document.getElementById('cons').innerText = litri.toFixed(1) + 'L';
        document.getElementById('kmTot').innerText = km;
        document.getElementById('targetIn').value = db.target || "";
        
        let manca = db.target - netto;
        document.getElementById('mancante').innerText = '€' + (manca > 0 ? manca.toFixed(2) : "0.00");
        
        let perc = db.target > 0 ? (netto / db.target) * 100 : 0;
        document.getElementById('bar').style.width = Math.min(perc, 100) + '%';
    }

    function apriM(id) { document.getElementById(id).style.display = 'flex'; }
    function chiudiM() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }

    function aggiungiTurno() {
        const t = {
            data: new Date().toLocaleDateString(),
            lordo: parseFloat(document.getElementById('tL').value) || 0,
            ore: parseFloat(document.getElementById('tO').value) || 0,
            km: parseFloat(document.getElementById('tK').value) || 0,
            cons: parseFloat(document.getElementById('tC').value) || 0
        };
        db.turni.push(t);
        salvaDB();
        chiudiM();
    }

    function salvaTarget() { db.target = parseFloat(document.getElementById('targetIn').value) || 0; salvaDB(); }
    function salvaTax() { db.tax = parseFloat(document.getElementById('taxIn').value) || 20; salvaDB(); }

    function generaReport() {
        let h = `<h3>REPORT MATRICE V1.0</h3><table class="report-table"><thead><tr><th>DATA</th><th>LORDO</th><th>KM</th><th>LITRI</th></tr></thead><tbody>`;
        db.turni.forEach(t => {
            h += `<tr><td>${t.data}</td><td>€${t.lordo.toFixed(2)}</td><td>${t.km}</td><td>${(t.km*(t.cons/100)).toFixed(1)}L</td></tr>`;
        });
        h += `</tbody></table>`;
        document.getElementById('repContent').innerHTML = h;
        document.getElementById('reportView').style.display = 'block';
    }

    window.onload = () => { calcola(); startClock(); };
</script>

<div id="modalTurno" class="modal no-print">
    <div class="modal-content">
        <h3>NUOVO TURNO</h3>
        <input type="number" id="tL" placeholder="Lordo (€)">
        <input type="number" id="tO" placeholder="Ore">
        <input type="number" id="tK" placeholder="KM">
        <input type="number" id="tC" placeholder="Consumo L/100km">
        <button class="btn-modal btn-save" onclick="aggiungiTurno()">SALVA</button>
        <button class="btn-modal btn-close" onclick="chiudiM()">ANNULLA</button>
    </div>
</div>

<div id="reportView">
    <div id="repContent"></div>
    <button class="btn-modal btn-close no-print" onclick="document.getElementById('reportView').style.display='none'">CHIUDI REPORT</button>
</div>

<div class="sticky-footer no-print">
    <div class="foot-btn" onclick="apriM('modalTurno')"><i class="fas fa-plus"></i>TURNO</div>
    <div class="foot-btn" onclick="alert('Storico Matrice V1.0')"><i class="fas fa-history"></i>STORICO</div>
    <div class="foot-btn" onclick="generaReport()"><i class="fas fa-file-pdf"></i>REPORT</div>
</div>
</body>
</html>
