<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rider Tracker</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --primary: #00f2ea; --secondary: #ff9d00; --text: #ffffff; --danger: #ff4b2b; --success: #4caf50; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; padding-bottom: 50px; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px dashed #333; }
        h2 { color: var(--primary); text-transform: uppercase; font-size: 0.8rem; margin: 0 0 15px 0; text-align: center; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        input, select { background: #2a2a2a; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; font-size: 1rem; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-session { background: #00897b; color: white; }
        .stat-val { font-size: 1.1rem; font-weight: bold; display: block; }
        .label { font-size: 0.6rem; color: #aaa; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .history-item { display: flex; justify-content: space-between; align-items: center; background: #252525; padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid var(--primary); font-size: 0.8rem; }
        .del-btn { background: var(--danger); color: white; width: 30px; height: 30px; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>üìä RIEPILOGO REALE</h2>
        <div class="grid" style="text-align:center;">
            <div><span class="label">NETTO VERO (Esclusa Benza)</span><span id="netto-totale" class="stat-val" style="color:var(--success)">0.00 ‚Ç¨</span></div>
            <div><span class="label">MEDIA MOTO (KM/L)</span><span id="media-kml" class="stat-val" style="color:var(--secondary)">0.0</span></div>
        </div>
        <div class="grid-3" style="text-align:center; border-top: 1px solid #333; padding-top: 10px;">
            <div><span class="label">ORE TOTALI</span><span id="ore-totali" class="stat-val">0.0</span></div>
            <div><span class="label">NETTO/ORA</span><span id="netto-ora" class="stat-val" style="color:var(--primary)">0.00</span></div>
            <div><span class="label">KM TOTALI</span><span id="km-totali" class="stat-val">0</span></div>
        </div>
        <div style="margin-top:15px; text-align:center; border: 1px solid #444; padding: 10px; border-radius: 8px;">
            <span class="label">‚öôÔ∏è IMPOSTA CONSUMO (L/100 KM)</span>
            <input type="number" id="consumo-l100" value="4.0" step="0.1" oninput="updateUI()" style="text-align:center; color:var(--secondary); font-weight:bold;">
        </div>
    </div>

    <div class="card" style="border-color: #00897b;">
        <h2>‚ûï REGISTRA TURNO</h2>
        <div class="grid-3">
            <select id="sess-g"><option value="">G</option></select>
            <select id="sess-m"><option value="">M</option></select>
            <select id="sess-a"><option value="">A</option></select>
        </div>
        <div class="grid">
            <input type="number" id="sess-lordo" placeholder="Lordo ‚Ç¨"><input type="number" id="sess-ore" placeholder="Ore">
        </div>
        <input type="number" id="sess-km" placeholder="KM PERCORSI OGGI" style="margin-bottom:10px;">
        <button class="btn-session" onclick="saveSessione()">SALVA GIORNATA</button>
    </div>

    <div class="card">
        <h2>üìú STORICO</h2>
        <div id="lista-storico"></div>
    </div>

    <button onclick="resettutto()" style="background:#333; color:gray; font-size:0.7rem; width:100%; border-radius:8px; padding:10px;">RESET TUTTO</button>

    <script>
        let db = JSON.parse(localStorage.getItem('rider_db_v11')) || { sessioni: [], consumoL100: 4.0 };

        function popolaDate() {
            const giorni = document.getElementById('sess-g'), mesi = document.getElementById('sess-m'), anni = document.getElementById('sess-a');
            for(let i=1; i<=31; i++) giorni.innerHTML += `<option value="${i}">${i}</option>`;
            for(let i=1; i<=12; i++) mesi.innerHTML += `<option value="${i}">${i}</option>`;
            for(let i=2025; i<=2040; i++) anni.innerHTML += `<option value="${i}">${i}</option>`;
        }

        function updateUI() {
            const l100 = parseFloat(document.getElementById('consumo-l100').value) || 0.1;
            db.consumoL100 = l100;
            let tNettoLordo = 0, tOre = 0, tKm = 0;
            const lista = document.getElementById('lista-storico');
            lista.innerHTML = "";

            db.sessioni.forEach((s, idx) => {
                tNettoLordo += (s.lordo * 0.8);
                tOre += parseFloat(s.ore || 0);
                tKm += parseFloat(s.km || 0);
                lista.innerHTML += `<div class="history-item"><span>üìÖ ${s.data}<br><b>${(s.lordo*0.8).toFixed(2)}‚Ç¨</b> | ${s.km}km</span><button class="del-btn" onclick="deleteItem(${idx})">X</button></div>`;
            });

            // Calcolo KM/L per la media visualizzata
            const kml = 100 / l100;
            
            // Calcolo costo benzina (basato su 1.80‚Ç¨/l)
            const litriTotali = (tKm * l100) / 100;
            const costoBenza = litriTotali * 1.80;
            const nettoVero = tNettoLordo - costoBenza;

            document.getElementById('netto-totale').innerText = nettoVero.toFixed(2) + " ‚Ç¨";
            document.getElementById('media-kml').innerText = kml.toFixed(1);
            document.getElementById('ore-totali').innerText = tOre.toFixed(1);
            document.getElementById('km-totali').innerText = tKm;
            document.getElementById('netto-ora').innerText = tOre > 0 ? (nettoVero / tOre).toFixed(2) : "0.00";
            
            localStorage.setItem('rider_db_v11', JSON.stringify(db));
        }

        function saveSessione() {
            const l = document.getElementById('sess-lordo').value, g = document.getElementById('sess-g').value, m = document.getElementById('sess-m').value, a = document.getElementById('sess-a').value, o = document.getElementById('sess-ore').value, k = document.getElementById('sess-km').value;
            if(!l || !o || !g || !m || !a || !k) return alert("Inserisci tutti i dati!");
            db.sessioni.push({ lordo: parseFloat(l), data: `${g}/${m}/${a}`, ore: parseFloat(o), km: parseFloat(k) });
            updateUI();
        }

        function deleteItem(index) { if(confirm("Eliminare?")) { db.sessioni.splice(index, 1); updateUI(); } }
        function resettutto() { if(confirm("Cancellare tutto?")) { localStorage.removeItem('rider_db_v11'); location.reload(); } }
        
        popolaDate();
        document.getElementById('consumo-l100').value = db.consumoL100;
        updateUI();
    </script>
</body>
</html>
