<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rider Tracker</title>
    <style>
        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --primary: #00f2ea;
            --secondary: #ff9d00;
            --text: #ffffff;
            --danger: #ff4b2b;
            --success: #4caf50;
        }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px dashed #333; }
        h2 { color: var(--primary); text-transform: uppercase; font-size: 0.9rem; margin-top: 0; text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        input { background: #2a2a2a; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; font-size: 1rem; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-save { background: var(--secondary); color: black; }
        .btn-session { background: #00897b; color: white; }
        .stat-val { font-size: 1.1rem; font-weight: bold; display: block; }
        .label { font-size: 0.65rem; color: #aaa; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .target-box { border: 1px solid #444; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 15px; }
        .lordo-label { color: var(--danger); font-weight: bold; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ðŸ“Š RIEPILOGO AVANZATO</h2>
        <div class="grid" style="text-align:center;">
            <div><span class="label">NETTO TOTALE</span><span id="netto-totale" class="stat-val" style="color:var(--success)">0.00 â‚¬</span></div>
            <div><span class="label">PROGRESSO TARGET</span><span id="progresso-target" class="stat-val">0%</span></div>
        </div>
        
        <div class="grid-3" style="text-align:center; border-top: 1px solid #333; padding-top: 10px;">
            <div><span class="label">ORE</span><span id="ore-totali" class="stat-val">0.0</span></div>
            <div><span class="label">NETTO/ORA</span><span id="netto-ora" class="stat-val" style="color:var(--primary)">0.00</span></div>
            <div><span class="label">MEDIA KM/L</span><span id="media-km" class="stat-val" style="color:var(--secondary)">0.0</span></div>
        </div>

        <div class="target-box" style="margin-top:15px;">
            <span class="label">ðŸŽ¯ TARGET NETTO (â‚¬)</span>
            <input type="number" id="target-input" placeholder="Vuoto" oninput="updateUI()">
            <p><span class="label">LORDO DA FARE:</span><span id="lordo-necessario" class="lordo-label">0.00 â‚¬</span></p>
        </div>
    </div>

    <div class="card" style="border-color: var(--secondary);">
        <h2>â›½ REGISTRA RIFORNIMENTO</h2>
        <span class="label">DATA (G/M/A)</span>
        <div class="grid-3">
            <input type="number" id="ref-g" placeholder="G">
            <input type="number" id="ref-m" placeholder="M">
            <input type="number" id="ref-a" placeholder="A">
        </div>
        <div class="grid">
            <input type="number" id="ref-euro" placeholder="Euro â‚¬">
            <input type="number" id="ref-litri" placeholder="â‚¬/l">
        </div>
        <button class="btn-save" onclick="saveRifornimento()">SALVA BENZINA</button>
    </div>

    <div class="card" style="border-color: #00897b;">
        <h2>âž• REGISTRA SESSIONE</h2>
        <span class="label">DATA (G/M/A)</span>
        <div class="grid-3">
            <input type="number" id="sess-g" placeholder="G">
            <input type="number" id="sess-m" placeholder="M">
            <input type="number" id="sess-a" placeholder="A">
        </div>
        <div class="grid">
            <input type="number" id="sess-lordo" placeholder="Lordo â‚¬">
            <input type="number" id="sess-ore" placeholder="Ore">
        </div>
        <div class="grid">
            <input type="number" id="sess-km" placeholder="Km percorsi">
            <input type="number" id="sess-scarto" placeholder="Scarto Km">
        </div>
        <button class="btn-session" onclick="saveSessione()">SALVA GIORNATA</button>
    </div>

    <button onclick="resettutto()" style="background:#333; color:gray; font-size:0.7rem; margin-top:20px;">RESET TOTALE DATI</button>

    <script>
        let db = JSON.parse(localStorage.getItem('rider_db_v3')) || {
            sessioni: [],
            rifornimenti: [],
            target: ""
        };

        function updateUI() {
            const target = document.getElementById('target-input').value;
            db.target = target;
            
            const lordoReq = target ? (target / 0.8).toFixed(2) : "0.00";
            document.getElementById('lordo-necessario').innerText = lordoReq + " â‚¬";
            
            let totaleNetto = 0;
            let totaleOre = 0;
            let totaleKm = 0;
            let totaleLitri = 0;

            db.sessioni.forEach(s => {
                totaleNetto += (s.lordo * 0.8);
                totaleOre += parseFloat(s.ore || 0);
                totaleKm += parseFloat(s.km || 0) - parseFloat(s.scarto || 0);
            });

            db.rifornimenti.forEach(r => {
                if(r.euro && r.prezzo) totaleLitri += (r.euro / r.prezzo);
            });
            
            document.getElementById('netto-totale').innerText = totaleNetto.toFixed(2) + " â‚¬";
            document.getElementById('ore-totali').innerText = totaleOre.toFixed(1);
            document.getElementById('netto-ora').innerText = totaleOre > 0 ? (totaleNetto / totaleOre).toFixed(2) : "0.00";
            document.getElementById('media-km').innerText = totaleLitri > 0 ? (totaleKm / totaleLitri).toFixed(1) : "0.0";
            
            if(target > 0) {
                let prog = (totaleNetto / target * 100).toFixed(0);
                document.getElementById('progresso-target').innerText = Math.min(prog, 100) + "%";
            } else {
                document.getElementById('progresso-target').innerText = "0%";
            }
            
            localStorage.setItem('rider_db_v3', JSON.stringify(db));
        }

        function saveRifornimento() {
            const euro = document.getElementById('ref-euro').value;
            const prezzo = document.getElementById('ref-litri').value;
            const g = document.getElementById('ref-g').value;
            const m = document.getElementById('ref-m').value;
            const a = document.getElementById('ref-a').value;
            if(!euro || !g || !m || !a || !prezzo) { alert("Dati incompleti!"); return; }
            db.rifornimenti.push({ euro: parseFloat(euro), prezzo: parseFloat(prezzo), data: `${g}/${m}/${a}` });
            alert("Benzina salvata!");
            updateUI();
        }

        function saveSessione() {
            const lordo = document.getElementById('sess-lordo').value;
            const g = document.getElementById('sess-g').value;
            const m = document.getElementById('sess-m').value;
            const a = document.getElementById('sess-a').value;
            const ore = document.getElementById('sess-ore').value;
            if(!lordo || !g || !m || !a || !ore) { alert("Dati lavoro incompleti!"); return; }
            db.sessioni.push({
                lordo: parseFloat(lordo),
                data: `${g}/${m}/${a}`,
                ore: parseFloat(ore),
                km: document.getElementById('sess-km').value || 0,
                scarto: document.getElementById('sess-scarto').value || 0
            });
            alert("Giornata salvata!");
            updateUI();
        }

        function resettutto() {
            if(confirm("Vuoi cancellare tutto?")) {
                localStorage.removeItem('rider_db_v3');
                location.reload();
            }
        }

        document.getElementById('target-input').value = db.target;
        updateUI();
    </script>
</body>
</html>
