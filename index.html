<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<title>RIDER TRACKER PRO V1.1</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
  --bg:#0f0f0f;
  --card:#1a1a1a;
  --primary:#00CCBC;
  --accent:#ff4d4d;
  --orange:#ffa500;
  --text:#e0e0e0;
  --dim:#888;
}

* {
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
}

html, body {
  margin:0;
  padding:0;
  width:100vw;
  height:100vh;
  background:var(--bg);
  color:var(--text);
  font-family:sans-serif;
  overflow:hidden; /* HOME SENZA SCROLL */
}

/* CONTENITORE PRINCIPALE */
#mainContainer {
  height:100vh;
  display:flex;
  flex-direction:column;
  padding:10px;
  gap:10px;
}

/* TITOLO */
.app-title {
  text-align:center;
  font-size:clamp(16px,3vw,22px);
  font-weight:900;
  color:var(--primary);
}

/* GRID CARD */
.grid {
  flex:1;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}

/* CARD RESPONSIVE */
.card {
  background:var(--card);
  border-radius:12px;
  border:1px solid #333;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  aspect-ratio:1/1;       /* MOD */
}

.label {
  font-size:clamp(7px,1.5vw,9px);
  color:var(--dim);
  font-weight:bold;
}

.val {
  font-size:clamp(12px,2.5vw,16px);
  font-weight:bold;
}

.card input {
  width:80%;
  background:transparent;
  border:none;
  border-bottom:1px solid #555;
  color:#fff;
  text-align:center;
  font-size:clamp(12px,2.5vw,16px);
  outline:none;
}

/* PROGRESS */
.progress-container {
  background:var(--card);
  border-radius:14px;
  padding:10px;
  border:1px solid #333;
}

.progress-header {
  text-align:center;
  font-size:clamp(11px,2vw,14px);
  font-weight:bold;
  color:var(--primary);
}

.progress-bar {
  margin-top:6px;
  height:22px;
  background:#222;
  border-radius:8px;
  overflow:hidden;
}

#bar {
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--primary),#ccff00);
}

/* FOOTER NON STICKY */
.sticky-footer {
  position:static;        /* MOD */
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
}

.foot-btn {
  background:#222;
  border:1px solid #444;
  border-radius:12px;
  padding:10px 5px;
  font-size:clamp(9px,2vw,11px);
  font-weight:bold;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.foot-btn i {
  font-size:clamp(16px,4vw,22px);
}

.btn-full {
  grid-column:span 4;
  background:var(--primary);
  color:#000;
  border:none;
  padding:14px;
  border-radius:14px;
  font-weight:900;
  font-size:clamp(12px,3vw,15px);
}

/* REPORT: SCROLL CONSENTITO */
#reportView {
  display:none;
  position:fixed;
  inset:0;
  background:#fff;
  color:#000;
  flex-direction:column;
}

.report-scroll-area {
  flex:1;
  overflow-y:auto; /* SOLO QUI */
  padding:15px;
}
</style>
</head>
<body>

<div id="mainContainer">
  <div class="app-title">RIDER TRACKER PRO V1.1</div>
  
  <div class="grid">
    </div>

  <div class="progress-container">
    <div class="progress-header">OBIETTIVO <span id="perc">0%</span></div>
    <div class="progress-bar"><div id="bar"></div></div>
  </div>

  <div class="sticky-footer">
    </div>
</div>

</body>
    <script>
    let db = JSON.parse(localStorage.getItem('rider_db_final_v34')) || { turni: [], rifornimenti: [], extraKm: [], targets: {}, tax: 20 };
    const mesi = ["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];

    // Inizializzazione e Orologio
    window.onload = function() { calcola(); startClock(); checkFineMese(); };

    function startClock() { 
        setInterval(() => { 
            const now = new Date(); 
            document.getElementById('liveClock').innerText = now.toLocaleString(); 
        }, 1000); 
    }

    // Calcoli Principali
    function calcola() {
        const n = new Date(); 
        const tag = `${(n.getMonth()+1).toString().padStart(2,'0')}/${n.getFullYear()}`;
        let lordoA = db.turni.reduce((a,b)=>a+b.lordo, 0);
        let ore = db.turni.reduce((a,b)=>a+b.ore, 0);
        let km = db.turni.reduce((a,b)=>a+b.km, 0);
        let litriS = db.turni.reduce((a,b)=>a+(b.km*(b.cons/100)), 0);
        let costoB_Turni = db.turni.reduce((acc, t) => acc + ((t.km * (t.cons / 100)) * (t.prezzo || 0)), 0);
        let nettoA = lordoA - (lordoA * (db.tax/100)) - costoB_Turni;

        document.getElementById('lordo').innerText = lordoA.toFixed(2); 
        document.getElementById('netto').innerText = '€' + nettoA.toFixed(2); 
        document.getElementById('ore').innerText = ore.toFixed(1); 
        document.getElementById('cons').innerText = litriS.toFixed(1) + 'L'; 
        document.getElementById('spesaB').innerText = '€' + db.rifornimenti.reduce((a,b)=>a+b.euro, 0).toFixed(2);
        
        let tNetto = db.targets[tag] || 0;
        let p = tNetto > 0 ? Math.min((nettoA/tNetto)*100, 100) : 0; 
        document.getElementById('perc').innerText = Math.round(p) + '%'; 
        document.getElementById('bar').style.width = p + '%';
        // ... (altri aggiornamenti UI)
    }

    // Gestione Dati
    function salvaDB() { localStorage.setItem('rider_db_final_v34', JSON.stringify(db)); calcola(); }

    function salvaTurno() { 
        if (db.rifornimenti.length === 0) { 
            document.getElementById('modalInizio').style.display = 'flex'; 
            return; 
        } 
        effettuaSalvataggioTurno(); 
    }

    function effettuaSalvataggioTurno() {
        const d = `${document.getElementById('dateTD').value.padStart(2,'0')}/${document.getElementById('dateTM').value.padStart(2,'0')}/${document.getElementById('dateTY').value}`;
        const rifOrdinati = [...db.rifornimenti].sort((a,b) => a.id - b.id);
        const prezzoCorrente = rifOrdinati.length ? rifOrdinati[rifOrdinati.length - 1].prezzo : 0;
        
        db.turni.push({
            id: Date.now(),
            data: d,
            ora: new Date().toLocaleTimeString().substring(0,5),
            lordo: parseFloat(document.getElementById('tL').value)||0,
            ore: parseFloat(document.getElementById('tO').value)||0,
            km: parseFloat(document.getElementById('tK').value)||0,
            cons: parseFloat(document.getElementById('tC').value)||0,
            prezzo: prezzoCorrente
        });
        salvaDB(); 
        chiudiModali();
    }

    // Funzioni UI
    function apriM(id) { /* Logica per popolare le date e mostrare modale */ }
    function chiudiModali() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
    function apriStorico() { /* Logica per generare la lista storica */ }
    function apriReport() { /* Logica per generare il riepilogo PDF */ }
</script>
</body>
</html>
