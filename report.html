<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report A4 Rider</title>
    <style>
        /* Reset per Mobile: Niente barre laterali */
        body { margin: 0; padding: 10px; font-family: sans-serif; background: #f4f4f4; color: #333; }
        
        .no-print-header { 
            display: flex; justify-content: space-between; gap: 10px; margin-bottom: 15px;
        }
        .btn { 
            flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 14px; 
        }
        .btn-close { background: #444; color: white; }
        .btn-print { background: #00CCBC; color: white; }

        /* Contenitore Report: Fluido su Mobile, A4 su Stampa */
        .report-container {
            background: white;
            padding: 20px;
            margin: 0 auto;
            max-width: 100%; /* Si adatta allo schermo */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        h2, h3 { color: #00CCBC; border-bottom: 2px solid #00CCBC; padding-bottom: 5px; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 12px; }
        table th, table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        table th { background: #f8f8f8; }

        .totali { background: #00CCBC; color: white; padding: 15px; border-radius: 8px; }
        .netto-row { font-size: 20px; font-weight: bold; margin-top: 10px; border-top: 1px dashed white; padding-top: 10px; }

        /* REGOLE PER LA STAMPA A4 */
        @media print {
            body { background: white; padding: 0; }
            .no-print-header { display: none; }
            .report-container { 
                box-shadow: none; 
                max-width: 210mm; /* Larghezza A4 */
                width: 100%;
                margin: 0;
            }
            table { page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
            @page { margin: 1cm; }
        }
    </style>
</head>
<body>

    <div class="no-print-header">
        <button class="btn btn-close" onclick="window.history.back()">CHIUDI</button>
        <button class="btn btn-print" onclick="window.print()">STAMPA PDF / A4</button>
    </div>

    <div class="report-container" id="report">
        <h2>Report Attività Rider Tracker Pro</h2>
        <p id="reportDate"></p>

        <h3>Dettaglio Turni</h3>
        <table id="tableTurni">
            <thead>
                <tr>
                    <th>Data</th><th>Lordo</th><th>Ore</th><th>KM</th><th>Consumo</th>
                </tr>
            </thead>
            <tbody id="bodyTurni"></tbody>
        </table>

        <h3>Dettaglio Carburante</h3>
        <table id="tableBenza">
            <thead>
                <tr>
                    <th>Data</th><th>Spesa</th><th>Prezzo/L</th>
                </tr>
            </thead>
            <tbody id="bodyBenza"></tbody>
        </table>

        <div class="totali">
            <div>Lordo Totale: <span id="resLordo"></span></div>
            <div>Imposte: <span id="resTax"></span></div>
            <div>Costo Benzina: <span id="resBenza"></span></div>
            <div class="netto-row">NETTO GUADAGNATO: <span id="resNetto"></span></div>
        </div>
    </div>

    <script>
        // Recupera i dati dal database v95 salvato in index.html
        const db = JSON.parse(localStorage.getItem('rider_db_v95')) || { s: [], r: [], tax: 20 };
        document.getElementById('reportDate').innerText = "Generato il: " + new Date().toLocaleString();

        let lordoT = 0, benzaT = 0;

        // Popola Turni
        db.s.forEach(t => {
            lordoT += t.l;
            const ltr = (t.k * (t.c / 100));
            const prezzo = db.r.length > 0 ? db.r[db.r.length-1].p : 1.85;
            benzaT += (ltr * prezzo);
            document.getElementById('bodyTurni').innerHTML += `
                <tr>
                    <td>${t.time}</td><td>€${t.l.toFixed(2)}</td><td>${t.o}h</td><td>${t.k}km</td><td>${ltr.toFixed(2)}L</td>
                </tr>`;
        });

        // Popola Benzina
        db.r.forEach(b => {
            document.getElementById('bodyBenza').innerHTML += `
                <tr>
                    <td>${b.time}</td><td>€${b.e.toFixed(2)}</td><td>€${b.p.toFixed(3)}/L</td>
                </tr>`;
        });

        const tasse = lordoT * (db.tax / 100);
        document.getElementById('resLordo').innerText = "€" + lordoT.toFixed(2);
        document.getElementById('resTax').innerText = "€" + tasse.toFixed(2);
        document.getElementById('resBenza').innerText = "€" + benzaT.toFixed(2);
        document.getElementById('resNetto').innerText = "€" + (lordoT - tasse - benzaT).toFixed(2);
    </script>
</body>
</html>
