<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Rider Tracker Pro</title>
    <style>
        body { font-family: sans-serif; padding: 20px; color: #333; line-height: 1.6; }
        h1, h2 { color: #000; border-bottom: 2px solid #00CCBC; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; }
        th { background-color: #00CCBC; color: white; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #ddd; }
        .summary { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        .netto { font-size: 1.2em; font-weight: bold; color: #ff4d4d; }
        .btn-print { background: #00CCBC; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 20px; }
        @media print { .btn-print { display: none; } }
    </style>
</head>
<body>

    <h1>REPORT ATTIVITÀ RIDER TRACKER PRO</h1>
    <button class="btn-print" onclick="window.print()">STAMPA REPORT / SALVA PDF</button>

    <h2>Dettaglio Turni</h2>
    <table>
        <thead>
            <tr>
                <th>Data/Ora</th>
                <th>Lordo</th>
                <th>Ore</th>
                <th>KM</th>
                <th>Consumo L</th>
            </tr>
        </thead>
        <tbody id="turniTable"></tbody>
    </table>

    <h2>Dettaglio Carburante</h2>
    <table>
        <thead>
            <tr>
                <th>Data/Ora Inserimento</th>
                <th>Spesa (€)</th>
                <th>Prezzo al Litro</th>
            </tr>
        </thead>
        <tbody id="benzaTable"></tbody>
    </table>

    <div class="summary">
        <h2>RIPILOGO TOTALI</h2>
        <p>Lordo Totale: <span id="totLordo">€0.00</span></p>
        <p>Tasse (<span id="taxPerc">20</span>%): <span id="totTasse">€0.00</span></p>
        <p>Costo Benzina Totale: <span id="totBenza">€0.00</span></p>
        <p class="netto">NETTO GUADAGNATO: <span id="totNetto">€0.00</span></p>
    </div>

    <script>
        function renderReport() {
            // Carica i dati dalla chiave v95 usata nell'index
            const db = JSON.parse(localStorage.getItem('rider_db_v95')) || { s: [], r: [], tax: 20 };
            
            const turniTable = document.getElementById('turniTable');
            const benzaTable = document.getElementById('benzaTable');
            
            let lordoTot = 0;
            let benzaTot = 0;
            let kmTot = 0;
            let litriTot = 0;

            // Render Turni
            turniTable.innerHTML = db.s.map(t => {
                lordoTot += t.l;
                let ltr = (t.k * (t.c / 100));
                litriTot += ltr;
                return `<tr><td>${t.time}</td><td>€${t.l.toFixed(2)}</td><td>${t.o}h</td><td>${t.k} km</td><td>${ltr.toFixed(2)} L</td></tr>`;
            }).join('');

            // Render Benzina
            benzaTable.innerHTML = db.r.map(b => {
                return `<tr><td>${b.time}</td><td>€${b.e.toFixed(2)}</td><td>€${b.p.toFixed(3)}/L</td></tr>`;
            }).join('');

            // Calcolo costi benzina (basato sul consumo dei turni e l'ultimo prezzo inserito)
            let ultimoPrezzo = db.r.length > 0 ? db.r[db.r.length - 1].p : 1.85;
            benzaTot = litriTot * ultimoPrezzo;

            let tasse = lordoTot * (db.tax / 100);
            let netto = lordoTot - tasse - benzaTot;

            document.getElementById('totLordo').innerText = `€${lordoTot.toFixed(2)}`;
            document.getElementById('taxPerc').innerText = db.tax;
            document.getElementById('totTasse').innerText = `€${tasse.toFixed(2)}`;
            document.getElementById('totBenza').innerText = `€${benzaTot.toFixed(2)}`;
            document.getElementById('totNetto').innerText = `€${netto.toFixed(2)}`;
        }

        window.onload = renderReport;
    </script>
</body>
</html>
